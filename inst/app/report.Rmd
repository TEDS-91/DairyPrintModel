---
title: "**DairyPrint Model Report**"
output:
  html_document:
    theme:
      version: 4
params:
  total_co2e_q_emitted: 'NULL'
  co2eq_milk: 'NULL'
  methane_table: 'NULL'
  suma_table: 'NULL'
  herd_inputs: 'NULL'
  nh3_emissions: 'NULL'
  crop_inputs: 'NULL'
  co2eq_purchased: 'NULL'
  fuel_inputs: 'NULL'
  purchased_feeds: 'NULL'
  raw_animal_df: 'NULL'
  manure_inputs: 'NULL'
  diet_inputs: 'NULL'
 
---

<style type = "text/css">

body{ /* Normal  */
      font-family: Helvetica;
      font-size: 12px;
      color: Grey;
        
  }
td {  /* Table  */
  font-family: Helvetica;
  font-size: 12px;
  text-align: center;
}
h1.title {
  font-family: Helvetica;
  font-size: 34px;
  color: #007582;
}
h1 { /* Header 1 */
  font-family: Helvetica;
  font-size: 28px;
  color: #007582;
  text-align: center;

}
h2 { /* Header 2 */
  font-family: Helvetica;
  font-size: 22px;
  color: #007582;
 
}
h3 { /* Header 3 */
  font-family: Helvetica;
  font-size: 18px;
  color: #007582;
  
}
h4 { /* Header 4 */
  font-family: Helvetica;
  font-size: 14px;
  color: #007582;
  
}
code.r{ /* Code block */
    font-family: Helvetica;
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-family: Helvetica;
    font-size: 14px;
}
</style>

<style>
.column-left{
  float: left;
  width: 50%;
  text-align: left;
}
.column-center{
  display: inline-block;
  width: 50%;
  text-align: center;
}
</style>

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

## **1. Farm Inputs:**

## {.tabset}

### **1.1 Herd Management**

```{r, warning = FALSE, echo = FALSE, message = FALSE}
library(formattable)
library(dplyr)

kableExtra::kbl(params$herd_inputs, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = T, color = "white", background = "#007582")

```

```{r, warning = FALSE, echo = FALSE}

kableExtra::kbl(params$diet_inputs, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = T, color = "white", background = "#007582")

```

### **1.2 Manure Management**

```{r, warning = FALSE, echo = FALSE}

manure_inputs <- params$manure_inputs 

kableExtra::kbl(manure_inputs, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = T, color = "white", background = "#007582")

```

### **1.3 Crops and Purchased Feeds**

#### **1.3.1 Crops**

```{r, warning = FALSE, echo = FALSE}

crop_inputs <- params$crop_inputs %>% 
  dplyr::select(-"crop_id") %>% 
  dplyr::rename(
    "Crop"                               = "crop_type",
    "Area"                               = "area",
    "Manure Applied (%)"                 = "manure_pct",
    "Total N Fertilizer Applied (kg/ha)" = "total_n_applied",
    "Urea Applied (% of N)"              = "urea_pct_applied",
    "Phosphate Applied (kg/ha)"          = "phosphate_applied",
    "Potash Applied (kg/ha)"             = "potash_applied",
    "Lime Applied (kg/ha)"               = "lime_applied"
  )

kableExtra::kbl(crop_inputs, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = TRUE, color = "white", background = "#007582")

```

#### **1.3.2 Purchased Feeds**

```{r, warning = FALSE, echo = FALSE}

purchased_feeds <- params$purchased_feeds %>%
  tibble::as_tibble() %>% 
  dplyr::rename(
    "Feeds"                         = "feeds",
    "Quantitity (ton.)"             = "Qntdds",
    "Carbon Footprint (Carbon eq.)" = "carbon_foot"
  )

kableExtra::kbl(purchased_feeds, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = TRUE, color = "white", background = "#007582")

```

### **1.4 Fuel Consumption**

```{r, warning = FALSE, echo = FALSE}

kableExtra::kbl(params$fuel_inputs, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = TRUE, color = "white", background = "#007582")

```

## {-}

## **2. Overall Environmental Outcomes** 

## {.tabset}

### **2.1 Herd**

```{r, warning = FALSE, echo = FALSE}

methane_table <- params$methane_table %>% tibble::as_tibble()
methane_table$`Methane (%)` <- color_bar("lightgreen")(methane_table$`Methane (%)`)

kableExtra::kbl(methane_table, escape = FALSE) %>%
  kableExtra::kable_paper("hover", full_width = TRUE) %>% 
  kableExtra::row_spec(0, bold = TRUE, color = "white", background = "#007582")

```


```{r, warning = FALSE, echo = FALSE, fig.width = 10, fig.height = 3, fig.fullwidth = TRUE}

animal_data_plots <- params$raw_animal_df %>%
  tibble::as_tibble() %>% 
  dplyr::filter(Categories == "Cow" & MonthSimulated == 1 & Phase %in% c("Lac1", "Lac2", "Lac3")) %>%
  dplyr::mutate(
    Phase = dplyr::if_else(Phase == "Lac1", "Primip", dplyr::if_else(Phase == "Lac2", "Second", "Multi"))
  ) 

milk_yield <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = milk_yield_kg_cow2, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Milk Yield (kg/day)") +
  ggplot2::theme(legend.position = "none")

DMI <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = dry_matter_intake_kg_animal, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Dry Matter Intake (kg/day)") +
  ggplot2::theme(legend.position = "bottom")

water_intake <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = water_intake_l_animal, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Water Intake (l/day)") +
  ggplot2::theme(legend.position = "none")

patchwork::wrap_plots(milk_yield, DMI, water_intake, ncol = 3)

```


```{r, warning = FALSE, echo = FALSE, fig.width = 10, fig.height = 3, fig.fullwidth = TRUE}

manure_excretion <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = fresh_manure_output_kg_day, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Manure Excretion (kg/day)") +
  ggplot2::theme(legend.position = "none")

enteric_methane <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = enteric_methane_g_animal_day, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Enteric Methane (kg/day)") +
  ggplot2::theme(legend.position = "bottom")

patchwork::wrap_plots(manure_excretion, enteric_methane, ncol = 2)

```

```{r, warning = FALSE, echo = FALSE, fig.width = 10, fig.height = 3, fig.fullwidth = TRUE}

nit_excretion <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = total_nitrogen_excreted_g, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Nitrogen Excretion (kg/day)") +
  ggplot2::theme(legend.position = "none")

phos_excretion <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = total_phosphorus_excretion_g, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Phosphorous Excretion (kg/day)") +
  ggplot2::theme(legend.position = "bottom")

pot_excretion <- animal_data_plots %>% 
  ggplot2::ggplot( ggplot2::aes(x = Month, y = total_potassium_excretion_g, col = Phase)) +
  ggplot2::theme_minimal() +
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::xlab("Months in lactation") + ggplot2::ylab(" ") + ggplot2::ggtitle("Potassium Excretion (kg/day)") +
  ggplot2::theme(legend.position = "none")

patchwork::wrap_plots(nit_excretion, phos_excretion, pot_excretion, ncol = 3)

```

### **2.2 Manure**

```{r, warning = FALSE, echo = FALSE, fig.width = 10, fig.height = 3, fig.fullwidth = TRUE}

barn <- params$nh3_emissions %>%
  dplyr::filter(year_day > 365) %>%
  ggplot2::ggplot( ggplot2::aes( x = year_day, y = barn_ch4_emissions_kg)) +
  ggplot2::theme_bw() +
  ggplot2::geom_point(col = "blue") +
  ggplot2::geom_line(ggplot2::aes( x = year_day, y = barn_ch4_emissions_kg), col = "black") +
  ggplot2::xlab("Year days") + ggplot2::ylab("Methane Emissions") + ggplot2::ggtitle("Barn")

storage <- params$nh3_emissions %>%
  dplyr::filter(year_day > 365) %>%
  ggplot2::ggplot( ggplot2::aes( x = year_day, y = storage_ch4_emissions_kg)) +
  ggplot2::theme_bw() +
  ggplot2::geom_point(col = "blue") +
  ggplot2::geom_line(ggplot2::aes( x = year_day, y = storage_ch4_emissions_kg), col = "blue") +
  ggplot2::xlab("Year days") + ggplot2::ylab("Methane Emissions") + ggplot2::ggtitle("Storage")

patchwork::wrap_plots(barn, storage, ncol = 2)

```

## {-}

### **Comments:**
<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

Here are the comments

</div>

&nbsp;
<hr />
<p style = "text-align: center; color: #007582;"> All rights reserved - University of Wisconsin-Madison </p>
<center>

```{r, warning = FALSE, echo = FALSE}

path_logo <- system.file("app/www", "uw_logo.png", package = "DairyPrintModel")

htmltools::img(
   src = knitr::image_uri(path_logo),
   style = "width:25px; height:40px;")
   
```
</center>
&nbsp;


